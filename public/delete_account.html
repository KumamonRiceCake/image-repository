<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Delete Account</title>
        <link rel="icon" href="/img/album.ico">
        <link rel="stylesheet" href="/css/styles.css">
    </head>
    <body>
        <div class="profile-main">
            <div class="delete-centered-form">
                <h1>Delete account</h1>
                <label>Please type <b>"Delete my account"</b> to confirm deletion.</label>
                <input type="text" id="confirm" />
                <button id="delete_button">Delete Account</button>
                <a href="/dashboard">Return to dashboard</a>
            </div>
        </div>

        <script>
            const deleteUserUrl = '/users/me';

            document.querySelector('#delete_button').addEventListener('click', () => {
                if (document.querySelector('#confirm').value === 'Delete my account') {
                    const xhr = new XMLHttpRequest();
                    xhr.open('DELETE', deleteUserUrl);

                    xhr.onreadystatechange = function () {
                        if (this.readyState === 4 && this.status === 200) {
                            location.href = '/';
                        }
                    };

                    xhr.send();
                } else {
                    alert('Please type confirm message first.');
                }
            });
        </script>
    </body>
</html>